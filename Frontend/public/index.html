<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Material+Icons"
    />
    <link rel="stylesheet" href="styles/bootstrap-material-design.min.css" />
    <link rel="stylesheet" href="styles/schedule.css" />
    <!-- <link rel="stylesheet" href="styles/chatteams.css" /> -->
    <link rel="stylesheet" href="styles/settings.css" />

    <title>Bon Meal Generator</title>
  </head>

  <body>
    <div id="mainPage" class="container page-container">
      <div class="App mx-auto"></div>
      <button
        id="newMealButton"
        type="button"
        class="btn"
        data-toggle="modal"
        data-target="#createMealDialog"
      >
        <div>Generate</div>
      </button>
      <!-- Modal -->
      <div
        class="modal fade"
        id="createMealDialog"
        tabindex="-1"
        role="dialog"
        aria-labelledby="exampleModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog modal-dialog-centered" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Generate Meal</h5>
            </div>
            <div class="modal-body">
              <div class="form-group bmd-form-group">
                <!-- left unspecified, .bmd-form-group will be automatically added (inspect the code) -->
                <label for="eventName" class="bmd-label-floating"
                  >How Many Calories?</label
                >
                <input type="text" class="form-control" id="numCalories" />
                <span class="bmd-help"
                  >Enter the quantity of calories in the meal desired</span
                >
              </div>
            </div>

            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-dismiss="modal"
              >
                CANCEL
              </button>
              <button
                id="createMealButton"
                type="button"
                class="btn btn-primary"
                data-dismiss="modal"
              >
                CREATE
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <script
      src="https://unpkg.com/react@16/umd/react.production.min.js"
      crossorigin
    ></script>
    <script
      src="https://unpkg.com/react-dom@16/umd/react-dom.production.min.js"
      crossorigin
    ></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="scripts/App.js"></script>
    <script type="text/babel" src="scripts/Row.js"></script>
    <script type="text/babel" src="scripts/Square.js"></script>
    <script type="text/babel">
      window.sessionStorage.clear(); // clears schedule
    </script>
    <script src="scripts/jquery.min.js"></script>
    <script src="scripts/popper.js"></script>
    <script src="scripts/bootstrap-material-design.js"></script>
    <script>
      $("body").bootstrapMaterialDesign();
    </script>
    <script src="/__/firebase/7.18.0/firebase-app.js"></script>
    <script src="/__/firebase/7.18.0/firebase-analytics.js"></script>
    <script src="/__/firebase/7.18.0/firebase-auth.js"></script>
    <script src="/__/firebase/7.18.0/firebase-firestore.js"></script>
    <script src="/__/firebase/init.js"></script>
    <script src="scripts/main.js"></script>
    <script type="text/babel">
      let beakerfast = breakfast()[0].items;
      let lunchtim = lunch()[0].items;
      let winnerwinner = dinner()[0].items;

      // Creates an alphabetized list of valid foods (ignores garnishes and overly long descriptors)

      // Creates an abbreviated version of the food at the given id
      function handleFood(rawStr) {
        let splitFood = getFoodWithId(rawStr).split(" ");

        let retStr = splitFood[splitFood.length - 1];
        let maxLength = 15;
        let curLen = retStr.length;

        // Prepends first descriptor
        let startStr = "";
        if (
          splitFood.length > 1 &&
          curLen + splitFood[0].length + 1 < maxLength
        ) {
          startStr = splitFood[0] + " ";
          curLen += splitFood[0].length + 1;
        }
        for (
          let i = splitFood.length - 2;
          i >= 1 && curLen + splitFood[i].length + 1 < maxLength; // this works because this will only run if the first word has already been added or if you can't add the first
          i--
        ) {
          retStr = splitFood[i] + " " + retStr;
          curLen += splitFood[i].length + 1;
        }
        return startStr + retStr;
        // return rawStr;
      }

      // Ensures unique foods
      let breakfas = new Map();
      for (let i = 0; i < beakerfast.length; i++) {
        let nexItem = handleFood(beakerfast[i]);
        if (nexItem) {
          breakfas.set(
            nexItem.substring(0, 1).toUpperCase() + nexItem.substring(1),
            beakerfast[i]
          );
        }
      }
      let lunc = new Map();
      for (let i = 0; i < lunchtim.length; i++) {
        let nexItem = handleFood(lunchtim[i]);
        if (nexItem) {
          lunc.set(
            nexItem.substring(0, 1).toUpperCase() + nexItem.substring(1),
            lunchtim[i]
          );
        }
      }
      let dinne = new Map();
      for (let i = 0; i < winnerwinner.length; i++) {
        let nexItem = handleFood(winnerwinner[i]);
        if (nexItem) {
          dinne.set(
            nexItem.substring(0, 1).toUpperCase() + nexItem.substring(1),
            winnerwinner[i]
          );
        }
      }

      // sorts the items alphabetically DEPRECATED TODO IMPLEMENT FOR MAPS
      const sortedBreakfas = new Map([...breakfas.entries()].sort());
      const sortedLunc = new Map([...lunc.entries()].sort());
      const sortedDinne = new Map([...dinne.entries()].sort());

      // Creates all the grid components
      let rows = [];
      let row = [];
      // Adds the components to the app

      // Creates grid for breakfast
      let curCol = -1; // iterates and loops at 7, allowing for
      let numCols = 7; // Arbitrary # columns length
      let curRow = 0;
      for (let [key, value] of sortedBreakfas.entries()) {
        // TODO DO NOT DELETE, use to debug names vs abbreviations
        // console.log(key + " = " + value);
        // console.log(getFoodWithId(value));
        curCol++;
        if (curCol == numCols) {
          curCol = 0;
          row = [];
          curRow++;
        }
        row.push(<Square food={key} foodid={value} />);
        rows[curRow] = <Row contents={row} />;
      }

      ReactDOM.render(<>{rows}</>, document.querySelector(".App"));
    </script>
  </body>
</html>
